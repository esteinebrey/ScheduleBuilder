<!DOCTYPE html>
<html lang="en">

<head>
  <title>View Courses</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="/scripts/navigationBarScript.js"></script>
  <script src="/scripts/offerings_scripts.js"></script>
</head>

<body>
  <div id="navBarContainer"></div>
  <h1>View Courses</h1>


  <select name="semesters" id="semesterDropdown" onChange="showCorrectTable(this); onSelect(this, false);">

  </select>
  <br>

  <table class="table" id="courseTable">
    <thead>
      <tr>
        <th scope="col">Name</th>
          <th scope="col">Code</th>
          <th scope="col">Credits</th>
          <th scope="col">Description</th>
      </tr>
      </thead>
      <tbody></tbody>
  </table>

  <table class="table" id="offeringTable">
    <thead>
      <tr>
        <th scope="col">Name</th>
          <th scope="col">Code</th>
          <th scope="col">Professor</th>
          <th scope="col">Credits</th>
          <th scope="col">Days</th>
          <th scope="col">Time</th>
          <th scope="col">Location</th>
      </tr>
      </thead>
      <tbody></tbody>
  </table>
  
</body>
<script>
  var isCourseTableShown = false;

  function determineTableShown() {
    isCourseTableShown = !isCourseTableShown;
    var offeringDisplay = isCourseTableShown ? 'none' : 'table';
    var courseDisplay = isCourseTableShown ? 'table' : 'none';
    $("#offeringTable").css("display", offeringDisplay);
    $("#courseTable").css("display", courseDisplay);
  }

  function setUpDropdown() {
    var dropdown = $("#semesterDropdown");
    dropdown.append('<option value="-1" selected>' + "All Courses" + '</option>');
  }

  function showCorrectTable(obj) {
    // console.log(obj.selectedIndex);
    // var dropdown = $("#semesterDropdown");
    // console.log(obj.options[obj.selectedIndex]);
    var semesterSelected = obj.options[obj.selectedIndex].value;
    if (semesterSelected == -1 && !isCourseTableShown) {
        determineTableShown()
    }
    else if (isCourseTableShown) {
        determineTableShown()
      }
  }

  function retrieveCourses() {
        // Create XMLHttpRequest
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            // Create JSON object
            var obj = JSON.parse(xhr.responseText);
            if (obj.length > 0) {
              // Access the table
              var table = $("#courseTable");
              var i;
              var courseInfo;
              for (i = 0; i < obj.length; i++) {
                courseInfo = obj[i];
                console.log(courseInfo);
                // For each contact, create a row and add it to the table
                createRow(courseInfo, table);
              }
            }

          }
        };
        xhr.open("GET", "getAllCourses", true);
        xhr.send();
  }

      // Add the contact info to the table as a row
      function createRow(courseInfo, table) {
        // Create the row and make each cell of the row
        var courseOutput = "<tr class='courseRow'>";
        courseOutput += "<td>" + courseInfo.name + "</td>";
        courseOutput += "<td>" + courseInfo.deptCode + " " + courseInfo.courseNumber + "</td>";
        courseOutput += "<td>" + courseInfo.credits + "</td>";
        courseOutput += "<td>" + courseInfo.description + "</td>";
        courseOutput += "</tr>"

        // Add the row to the table
        table.append(courseOutput);
      }

      window.addEventListener("load", retrieveCourses, false);
      window.addEventListener("load", retrieveSemesters, false);
      window.addEventListener("load", determineTableShown, false);
      window.addEventListener("load", setUpDropdown, false);
</script>
</html>